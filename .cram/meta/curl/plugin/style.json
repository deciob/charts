{"absId":"curl/plugin/style","url":"/home/decio/dev/personal/nightcharts-gh/bower_components/curl/src/curl/plugin/style.js","source":"/** MIT License (c) copyright 2010-2013 B Cavalier & J Hann */\n\n/**\n * curl style! plugin\n */\n\ndefine([], function () {\n\n\tvar nonRelUrlRe, findUrlRx, undef, doc, head;\n\n\tif (typeof window != 'undefined') {\n\t\tdoc = window.document;\n\t\thead = doc.head || doc.getElementsByTagName('head')[0];\n\t}\n\n\t// tests for absolute urls and root-relative urls\n\tnonRelUrlRe = /^\\/|^[^:]*:\\/\\//;\n\t// Note: this will fail if there are parentheses in the url\n\tfindUrlRx = /url\\s*\\(['\"]?([^'\"\\)]*)['\"]?\\)/g;\n\n\tfunction translateUrls (cssText, baseUrl) {\n\t\treturn cssText.replace(findUrlRx, function (all, url) {\n\t\t\treturn 'url(\"' + translateUrl(url, baseUrl) + '\")';\n\t\t});\n\t}\n\n\tfunction translateUrl (url, parentPath) {\n\t\t// if this is a relative url\n\t\tif (!nonRelUrlRe.test(url)) {\n\t\t\t// append path onto it\n\t\t\turl = parentPath + url;\n\t\t}\n\t\treturn url;\n\t}\n\n\t/***** style element functions *****/\n\n\tvar currentStyle, callbacks = [];\n\n\tfunction createStyle (cssText, callback, errback) {\n\n\t\ttry {\n\t\t\tclearTimeout(createStyle.debouncer);\n\t\t\tif (createStyle.accum) {\n\t\t\t\tcreateStyle.accum.push(cssText);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcreateStyle.accum = [cssText];\n\t\t\t\tcurrentStyle = doc.createStyleSheet ? doc.createStyleSheet() :\n\t\t\t\t\thead.appendChild(doc.createElement('style'));\n\t\t\t}\n\n\t\t\tcallbacks.push({\n\t\t\t\tcallback: callback,\n\t\t\t\terrback: errback,\n\t\t\t\tsheet: currentStyle\n\t\t\t});\n\n\t\t\tcreateStyle.debouncer = setTimeout(function () {\n\t\t\t\tvar style, allCssText;\n\n\t\t\t\ttry {\n\t\t\t\t\tstyle = currentStyle;\n\t\t\t\t\tcurrentStyle = undef;\n\n\t\t\t\t\tallCssText = createStyle.accum.join('\\n');\n\t\t\t\t\tcreateStyle.accum = undef;\n\n\t\t\t\t\t// for safari which chokes on @charset \"UTF-8\";\n\t\t\t\t\t// TODO: see if Safari 5.x and up still complain\n\t\t\t\t\tallCssText = allCssText.replace(/.+charset[^;]+;/g, '');\n\n\t\t\t\t\t// IE 6-8 won't accept the W3C method for inserting css text\n\t\t\t\t\t'cssText' in style ? style.cssText = allCssText :\n\t\t\t\t\t\tstyle.appendChild(doc.createTextNode(allCssText));\n\n\t\t\t\t\twaitForDocumentComplete(notify);\n\t\t\t\t}\n\t\t\t\tcatch (ex) {\n\t\t\t\t\t// just notify most recent errback. no need to spam\n\t\t\t\t\terrback(ex);\n\t\t\t\t}\n\n\t\t\t}, 0);\n\n\t\t}\n\t\tcatch (ex) {\n\t\t\terrback(ex);\n\t\t}\n\n\t}\n\n\tfunction notify () {\n\t\tvar list = callbacks;\n\t\tcallbacks = [];\n\t\tfor (var i = 0, len = list.length; i < len; i++) {\n\t\t\tlist[i].callback(list[i].sheet);\n\t\t}\n\t}\n\n\t/**\n\t * Keep checking for the document readyState to be \"complete\" since\n\t * Chrome doesn't apply the styles to the document until that time.\n\t * If we return before readyState == 'complete', Chrome may not have\n\t * applied the styles, yet.\n\t * Chrome only.\n\t * @private\n\t * @param cb\n\t */\n\tfunction waitForDocumentComplete (cb) {\n\t\t// this isn't exactly the same as domReady (when dom can be\n\t\t// manipulated). it's later (when styles are applied).\n\t\t// chrome needs this (and opera?)\n\t\tfunction complete () {\n\t\t\tif (isDocumentComplete()) {\n\t\t\t\tcb();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsetTimeout(complete, 10);\n\t\t\t}\n\t\t}\n\t\tcomplete();\n\t}\n\n\t/**\n\t * Returns true if the documents' readyState == 'complete' or the\n\t * document doesn't implement readyState.\n\t * Chrome only.\n\t * @private\n\t * @return {Boolean}\n\t */\n\tfunction isDocumentComplete () {\n\t\treturn !doc.readyState || doc.readyState == 'complete';\n\t}\n\n\tcreateStyle.load = function (absId, req, loaded, config) {\n\t\t// get css text\n\t\treq([absId], function (cssText) {\n\t\t\t// TODO: translate urls?\n\t\t\tcreateStyle(cssText, loaded, loaded.error);\n\t\t});\n\t};\n\n\tcreateStyle.translateUrls = translateUrls;\n\n\treturn createStyle;\n});\n","modules":[{"pos":95,"count":23,"factory":true,"id":"curl/plugin/style"}],"compileTime":"2014-03-24T21:52:53.152Z"}