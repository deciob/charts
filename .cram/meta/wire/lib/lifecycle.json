{"absId":"wire/lib/lifecycle","url":"/home/decio/dev/personal/nightcharts-gh/bower_components/wire/lib/lifecycle.js","source":"/** @license MIT License (c) copyright B Cavalier & J Hann */\n\n/**\n * Licensed under the MIT License at:\n * http://www.opensource.org/licenses/mit-license.php\n */\n\n(function(define){ 'use strict';\ndefine(function(require) {\n\n\tvar when, safeNonFacetNames;\n\n\twhen = require('when');\n\tsafeNonFacetNames = {\n\t\tid: { value: 1 }\n\t};\n\n\tfunction Lifecycle(plugins, pluginApi) {\n\t\tthis._plugins = plugins;\n\t\tthis._pluginApi = pluginApi;\n\t}\n\n\tLifecycle.prototype = {\n\t\tinit: createLifecyclePhase(['create', 'configure', 'initialize']),\n\t\tstartup: createLifecyclePhase(['connect', 'ready']),\n\t\tshutdown: createLifecyclePhase(['destroy'])\n\t};\n\n\treturn Lifecycle;\n\n\t/**\n\t * Generate a method to process all steps in a lifecycle phase\n\t * @return {Function}\n\t */\n\tfunction createLifecyclePhase(steps) {\n\t\tsteps = generateSteps(steps);\n\n\t\treturn function(proxy) {\n\t\t\tvar plugins, pluginApi;\n\n\t\t\tplugins = this._plugins;\n\t\t\tpluginApi = this._pluginApi.contextualize(proxy.id);\n\n\t\t\treturn when.reduce(steps, function (unused, step) {\n\t\t\t\treturn processFacets(step, proxy, pluginApi, plugins);\n\t\t\t}, proxy);\n\t\t};\n\t}\n\n\tfunction processFacets(step, proxy, api, plugins) {\n\t\tvar promises, metadata, options, name, spec, facets, safeNames, unprocessed;\n\n\t\tpromises = [];\n\t\tmetadata = proxy.metadata;\n\t\tspec = metadata.spec;\n\t\tfacets = plugins.facets;\n\t\tsafeNames = Object.create(plugins.factories, safeNonFacetNames);\n\t\tunprocessed = [];\n\n\t\tfor(name in spec) {\n\t\t\tif(name in facets) {\n\t\t\t\toptions = spec[name];\n\t\t\t\tif (options) {\n\t\t\t\t\tprocessStep(promises, facets[name], step, proxy, options, api);\n\t\t\t\t}\n\t\t\t} else if (!(name in safeNames)) {\n\t\t\t\tunprocessed.push(name);\n\t\t\t}\n\t\t}\n\n\t\tif(unprocessed.length) {\n\t\t\treturn when.reject(unrecognizedFacets(proxy, unprocessed, spec));\n\t\t} else {\n\t\t\treturn when.all(promises).then(function () {\n\t\t\t\treturn processListeners(step, proxy, api, plugins.listeners);\n\t\t\t}).yield(proxy);\n\t\t}\n\t}\n\n\tfunction processListeners(step, proxy, api, listeners) {\n\t\tvar listenerPromises = [];\n\n\t\tfor (var i = 0; i < listeners.length; i++) {\n\t\t\tprocessStep(listenerPromises, listeners[i], step, proxy, {}, api);\n\t\t}\n\n\t\treturn when.all(listenerPromises);\n\t}\n\n\tfunction processStep(promises, processor, step, proxy, options, api) {\n\t\tvar facet, pendingFacet;\n\n\t\tif (processor && processor[step]) {\n\t\t\tpendingFacet = when.defer();\n\t\t\tpromises.push(pendingFacet.promise);\n\n\t\t\tfacet = Object.create(proxy);\n\t\t\tfacet.options = options;\n\t\t\tprocessor[step](pendingFacet.resolver, facet, api);\n\t\t}\n\t}\n\n\tfunction generateSteps(steps) {\n\t\treturn steps.reduce(reduceSteps, []);\n\t}\n\n\tfunction reduceSteps(lifecycle, step) {\n\t\tlifecycle.push(step + ':before');\n\t\tlifecycle.push(step);\n\t\tlifecycle.push(step + ':after');\n\t\treturn lifecycle;\n\t}\n\n\tfunction unrecognizedFacets(proxy, unprocessed, spec) {\n\t\treturn new Error('unrecognized facets in ' + proxy.id + ', maybe you forgot a plugin? ' + unprocessed.join(', ') + '\\n' + JSON.stringify(spec));\n\t}\n\n});\n})(typeof define == 'function'\n\t// AMD\n\t? define\n\t// CommonJS\n\t: function(factory) { module.exports = factory(require); }\n);","modules":[{"pos":197,"count":25,"factory":true,"argList":["require"],"requires":[{"id":"when","pos":264,"count":15}],"id":"wire/lib/lifecycle"}],"compileTime":"2014-03-24T21:53:07.488Z"}