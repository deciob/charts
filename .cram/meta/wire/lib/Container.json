{"absId":"wire/lib/Container","url":"/home/decio/dev/personal/nightcharts-gh/bower_components/wire/lib/Container.js","source":"/** @license MIT License (c) copyright B Cavalier & J Hann */\n\n/**\n * Licensed under the MIT License at:\n * http://www.opensource.org/licenses/mit-license.php\n */\n\n(function(define){ 'use strict';\ndefine(function(require) {\n\n\tvar when, advice, object, WireContext, Scope,\n\t\tPluginRegistry, defaultPlugins,\n\t\tDirectedGraph, trackInflightRefs, slice, scopeProto, undef;\n\n\twhen = require('when');\n\tadvice = require('./advice');\n\tobject = require('./object');\n\tWireContext = require('./WireContext');\n\tScope = require('./scope');\n\tPluginRegistry = require('./plugin/registry');\n\tdefaultPlugins = require('./plugin/defaultPlugins');\n\tDirectedGraph = require('./graph/DirectedGraph');\n\ttrackInflightRefs = require('./graph/trackInflightRefs');\n\tslice = Array.prototype.slice;\n\n\tscopeProto = Scope.prototype;\n\n\tfunction Container() {\n\t\tScope.apply(this, arguments);\n\t}\n\n\t/**\n\t * Container inherits from Scope, adding plugin support and\n\t * context level events.\n\t */\n\tContainer.prototype = object.extend(scopeProto, {\n\t\t_inheritInstances: function(parent) {\n\t\t\tvar publicApi = {\n\t\t\t\twire: this._createChildContext.bind(this),\n\t\t\t\tdestroy: this.destroy.bind(this),\n\t\t\t\tresolve: this._resolveRef.bind(this)\n\t\t\t};\n\n\t\t\treturn WireContext.inherit(parent.instances, publicApi);\n\t\t},\n\n\t\t_init: advice.after(\n\t\t\tscopeProto._init,\n\t\t\tfunction() {\n\t\t\t\tthis.plugins = new PluginRegistry();\n\t\t\t\treturn this._installDefaultPlugins();\n\t\t\t}\n\t\t),\n\n\t\t_startup: advice.after(\n\t\t\tscopeProto._startup,\n\t\t\tfunction(started) {\n\t\t\t\tvar self = this;\n\t\t\t\treturn when.resolve(started).otherwise(function(e) {\n\t\t\t\t\treturn self._contextEvent('error', e).yield(started);\n\t\t\t\t});\n\t\t\t}\n\t\t),\n\n\t\t_installDefaultPlugins: function() {\n\t\t\treturn this._installPlugins(defaultPlugins);\n\t\t},\n\n\t\t_installPlugins: function(plugins) {\n\t\t\tif(!plugins) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tvar self, registry, installed;\n\n\t\t\tself = this;\n\t\t\tregistry = this.plugins;\n\n\t\t\tif(Array.isArray(plugins)) {\n\t\t\t\tinstalled = plugins.map(function(plugin) {\n\t\t\t\t\treturn installPlugin(plugin);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tinstalled = Object.keys(plugins).map(function(namespace) {\n\t\t\t\t\treturn installPlugin(plugins[namespace], namespace);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn when.all(installed);\n\n\t\t\tfunction installPlugin(pluginSpec, namespace) {\n\t\t\t\tvar module, t;\n\n\t\t\t\tt = typeof pluginSpec;\n\t\t\t\tif(t == 'string') {\n\t\t\t\t\tmodule = pluginSpec;\n\t\t\t\t\tpluginSpec = {};\n\t\t\t\t} else if(typeof pluginSpec.module == 'string') {\n\t\t\t\t\tmodule = pluginSpec.module;\n\t\t\t\t} else {\n\t\t\t\t\tmodule = pluginSpec;\n\t\t\t\t}\n\n\t\t\t\treturn self.getModule(module).then(function(plugin) {\n\t\t\t\t\treturn registry.scanModule(plugin, pluginSpec, namespace);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t_createResolver: advice.after(\n\t\t\tscopeProto._createResolver,\n\t\t\tfunction(resolver) {\n\t\t\t\treturn trackInflightRefs(\n\t\t\t\t\tnew DirectedGraph(), resolver, this.refCycleTimeout);\n\t\t\t}\n\t\t),\n\n\t\t_contextEvent: function (type, data) {\n\t\t\tvar api, listeners;\n\n\t\t\tif(!this.contextEventApi) {\n\t\t\t\tthis.contextEventApi = this._pluginApi.contextualize(this.path);\n\t\t\t}\n\n\t\t\tapi = this.contextEventApi;\n\t\t\tlisteners = this.plugins.contextListeners;\n\n\t\t\treturn when.reduce(listeners, function(undef, listener) {\n\t\t\t\tvar d;\n\n\t\t\t\tif(listener[type]) {\n\t\t\t\t\td = when.defer();\n\t\t\t\t\tlistener[type](d.resolver, api, data);\n\t\t\t\t\treturn d.promise;\n\t\t\t\t}\n\n\t\t\t\treturn undef;\n\t\t\t}, undef);\n\t\t},\n\n\t\t_createComponents: advice.beforeAsync(\n\t\t\tscopeProto._createComponents,\n\t\t\tfunction(parsed) {\n\t\t\t\tvar self = this;\n\t\t\t\treturn this._installPlugins(parsed.plugins)\n\t\t\t\t\t.then(function() {\n\t\t\t\t\t\treturn self._contextEvent('initialize');\n\t\t\t\t\t});\n\t\t\t}\n\t\t),\n\n\t\t_awaitInstances: advice.afterAsync(\n\t\t\tscopeProto._awaitInstances,\n\t\t\tfunction() {\n\t\t\t\treturn this._contextEvent('ready');\n\t\t\t}\n\t\t),\n\n\t\t_destroyComponents: advice.beforeAsync(\n\t\t\tscopeProto._destroyComponents,\n\t\t\tfunction() {\n\t\t\t\treturn this._contextEvent('shutdown');\n\t\t\t}\n\t\t),\n\n\t\t_releaseResources: advice.beforeAsync(\n\t\t\tscopeProto._releaseResources,\n\t\t\tfunction() {\n\t\t\t\treturn this._contextEvent('destroy');\n\t\t\t}\n\t\t)\n\t});\n\n\treturn Container;\n\n});\n}(typeof define === 'function' ? define : function(factory) { module.exports = factory(require); }));\n","modules":[{"pos":197,"count":25,"factory":true,"argList":["require"],"requires":[{"id":"when","pos":377,"count":15},{"id":"./advice","pos":404,"count":19},{"id":"./object","pos":435,"count":19},{"id":"./WireContext","pos":471,"count":24},{"id":"./scope","pos":506,"count":18},{"id":"./plugin/registry","pos":544,"count":28},{"id":"./plugin/defaultPlugins","pos":592,"count":34},{"id":"./graph/DirectedGraph","pos":645,"count":32},{"id":"./graph/trackInflightRefs","pos":700,"count":36}],"id":"wire/lib/Container"}],"compileTime":"2014-03-24T21:53:07.515Z"}