<!DOCTYPE html>

<html>
<head>
  <title>nightcharts.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>nightcharts.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
define(<span class="string">'draw'</span>,[<span class="string">'require'</span>],<span class="function"><span class="keyword">function</span><span class="params">(require)</span> {</span>
  

  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(Chart, selection, data)</span> {</span>
    <span class="keyword">if</span> (data) {
      <span class="keyword">return</span> <span class="keyword">new</span> Chart(selection.datum(data));
    }
    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(data)</span> {</span>
      <span class="keyword">return</span> <span class="keyword">new</span> Chart(selection.datum(data));
    }
  }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p><strong>The default base configuration module</strong></p>
<p>Data structures:</p>
<p>bar:
data = [ [ [], [], [], ... [] ], ... ]
svg.data( [data] )</p>
<p>line:
data = [ [ [], [], [], ... [] ], ... ]
svg.data( [data] )
__.x_axis_data = data[0]  #FIXME</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>define(<span class="string">'base_config'</span>, [
  <span class="string">"d3"</span>, 
], <span class="function"><span class="keyword">function</span><span class="params">(d3)</span> {</span>
    
    <span class="keyword">return</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>layout.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      margin: {top: <span class="number">20</span>, right: <span class="number">20</span>, bottom: <span class="number">40</span>, left: <span class="number">40</span>},
      width: <span class="keyword">void</span> <span class="number">0</span>,
      height: <span class="keyword">void</span> <span class="number">0</span>, <span class="comment">// if set, height has precedence on ratio</span>
      ratio: <span class="number">.4</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>      offset_x: <span class="number">0</span>,
      offset_y: <span class="number">0</span>, <span class="comment">// FIXME!!!</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>vertical: true,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      quantitative_scale: <span class="string">'y'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>One of: ordinal, linear, time</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      x_scale: <span class="string">'ordinal'</span>,
      y_scale: <span class="string">'linear'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Forces the quantitative scale bounds:
false    -&gt;  min: 0, max: data_max
true     -&gt;  min: data_min, max: data_max
obj      -&gt;  min: obj.min, max: obj.max</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      scale_bounds: <span class="string">'0,max'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>axes, apart from <code>show</code>, properties match d3&#39;s api.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      x_axis: {
        show: <span class="literal">true</span>,
        outerTickSize: <span class="number">0</span>,
        orient: <span class="string">'bottom'</span>,
        tickValues: <span class="keyword">void</span> <span class="number">0</span>,
        tickFormat: <span class="literal">null</span>,
      },
      y_axis: {
        show: <span class="literal">true</span>,
        outerTickSize: <span class="number">0</span>,
        orient: <span class="string">'left'</span>,
        tickValues: <span class="keyword">void</span> <span class="number">0</span>,
      },</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>if x_scale: &#39;time&#39;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      date_type: <span class="string">'string'</span>, <span class="comment">// or 'epoc'</span>
      date_format: <span class="string">'%Y'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>false or string: &#39;month&#39;, &#39;year&#39;, etc.
used for extending the timescale on the margins.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      date_offset: <span class="literal">false</span>,
      duration: <span class="number">900</span>,  <span class="comment">// transition duration</span>
      invert_data: <span class="literal">false</span>,  <span class="comment">// Data sorting</span>
      categoricalValue: <span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span> <span class="keyword">return</span> d[<span class="number">0</span>]; },
      quantativeValue: <span class="function"><span class="keyword">function</span> <span class="params">(d)</span> {</span> <span class="keyword">return</span> d[<span class="number">1</span>]; },</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      handleClick: <span class="function"><span class="keyword">function</span> <span class="params">(d, i)</span> {</span> <span class="keyword">return</span> <span class="keyword">void</span> <span class="number">0</span>; },
      handleTransitionEnd: <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> <span class="keyword">void</span> <span class="number">0</span>; },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><a href="https://github.com/Caged/d3-tip">d3-tip</a> tooltips,
can pass boolean or object with d3-tip configuration.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tooltip: <span class="literal">false</span>,
      overlapping_charts: { names: [] }
    };
  
});</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>Useful functions that can be shared across modules</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>define(<span class="string">'utils/mixins'</span>,[<span class="string">"d3"</span>, <span class="string">"d3_tip"</span>], <span class="function"><span class="keyword">function</span><span class="params">(d3, d3_tip)</span> {</span>

  <span class="function"><span class="keyword">function</span> <span class="title">clone</span> <span class="params">(obj)</span> {</span>
    <span class="keyword">if</span> (<span class="literal">null</span> == obj || <span class="string">"object"</span> != <span class="keyword">typeof</span> obj) <span class="keyword">return</span> obj;
    <span class="keyword">var</span> copy = obj.constructor();
    <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> obj) {
      <span class="keyword">if</span> (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];
    }
    <span class="keyword">return</span> copy;
  }

  <span class="function"><span class="keyword">function</span> <span class="title">extend</span> <span class="params">(target, source, clone_target, not_override)</span> {</span>
    <span class="keyword">var</span> clone_target = (<span class="keyword">typeof</span> clone === <span class="string">"undefined"</span>) ? <span class="literal">true</span> : clone,
        target_c = clone_target ? clone(target): target;
    <span class="keyword">for</span>(prop <span class="keyword">in</span> source) {
      <span class="keyword">if</span> (not_override) {
        target_c[prop] = target_c[prop] ? target_c[prop] : source[prop];
      } <span class="keyword">else</span> {
        target_c[prop] = source[prop];
      }
    }
    <span class="keyword">return</span> target_c;
  }

  <span class="function"><span class="keyword">function</span> <span class="title">isObject</span> <span class="params">(o)</span> {</span>
    <span class="keyword">return</span> Object.prototype.toString.call(o) === <span class="string">"[object Object]"</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>For each attribute in <code>state</code> it sets a getter-setter function 
on <code>obj</code>.
Accepts one level nested <code>state</code> objects.
TODO: make this function less convoluted.</p>
<p>obj - object or function
state - object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">getset</span> <span class="params">(obj, state)</span> {</span>
    d3.entries(state).forEach(<span class="function"><span class="keyword">function</span><span class="params">(o)</span> {</span>
      obj[o.key] = <span class="function"><span class="keyword">function</span> <span class="params">(x)</span> {</span>
        <span class="keyword">if</span> (!arguments.length) <span class="keyword">return</span> state[o.key];
        <span class="keyword">var</span> old = state[o.key];
        state[o.key] = x;
        <span class="keyword">if</span> ( isObject(o.value) ) {
          d3.keys(o.value).forEach(<span class="function"><span class="keyword">function</span><span class="params">(key)</span> {</span>
            state[o.key][key] = <span class="keyword">typeof</span> x[key] !== <span class="string">'undefined'</span> ? x[key] : o.value[key];
          });
        }
        <span class="keyword">return</span> obj;
      }
    });
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Fires a callback when all transitions of a chart have ended.
The solution is inspired from a reply in 
<a href="https://groups.google.com/forum/#!msg/d3-js/WC_7Xi6VV50/j1HK0vIWI-EJ">Single event at end of transition?</a>. 
The original suggestion assumes the data length never changes, this 
instead also accounts for <code>exits</code> during the transition.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">endall</span> <span class="params">(elements_in_transition, data, callback)</span> {</span>
    <span class="keyword">var</span> n = data.length;
    elements_in_transition 
      .each(<span class="string">"end"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> 
        <span class="keyword">if</span> (!--n) {
          callback.apply(<span class="keyword">this</span>, arguments);
        }
      });
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Initializes a <a href="https://github.com/Caged/d3-tip">d3-tip</a> tooltip.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">tip</span> <span class="params">(obj)</span> {</span>
    <span class="keyword">var</span> tip = d3_tip()
      .attr(<span class="string">'class'</span>, <span class="string">'d3-tip'</span>)
      .html(<span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d; });
    <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">'boolean'</span>) {
      Object.keys(obj).forEach(<span class="function"><span class="keyword">function</span><span class="params">(key)</span> {</span>
        <span class="keyword">var</span> value = obj[key];
        <span class="keyword">if</span> (key === <span class="string">'attr'</span>) {
          tip.attr(value[<span class="number">0</span>], value[<span class="number">1</span>]);
        } <span class="keyword">else</span> {
          tip[key](value);
        }  
      });
    }
    <span class="keyword">return</span> tip;
  }

  <span class="function"><span class="keyword">function</span> <span class="title">getGraphHelperMethod</span> <span class="params">(chart_name)</span> {</span>
    <span class="keyword">var</span> name = chart_name.replace(<span class="regexp">/(?:^|\s)\S/g</span>, 
      <span class="function"><span class="keyword">function</span><span class="params">(a)</span> {</span> <span class="keyword">return</span> a.toUpperCase(); });
    <span class="keyword">return</span> <span class="keyword">this</span>[<span class="string">'set'</span> + name];
  }

  <span class="function"><span class="keyword">function</span> <span class="title">getMinMaxValues</span> <span class="params">(data)</span> {</span>
    <span class="keyword">var</span> min = <span class="literal">Infinity</span>,
        max = <span class="number">0</span>;
    data.forEach( <span class="function"><span class="keyword">function</span> <span class="params">(data, i)</span> {</span>
      <span class="keyword">var</span> min_p = d3.min( data, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> parseFloat(d[<span class="number">1</span>]); } ),
          max_p = d3.max( data, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> parseFloat(d[<span class="number">1</span>]); } );
      min = min_p &lt; min ? min_p : min;
      max = max_p &gt; max ? max_p : max;
    });
    <span class="keyword">return</span> {min: min, max: max};
  }

  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">this</span>.clone = clone;
    <span class="keyword">this</span>.extend = extend;
    <span class="keyword">this</span>.isObject = isObject;
    <span class="keyword">this</span>.getset = getset;
    <span class="keyword">this</span>.endall = endall;
    <span class="keyword">this</span>.tip = tip;
    <span class="keyword">this</span>.getGraphHelperMethod = getGraphHelperMethod;
    <span class="keyword">this</span>.getMinMaxValues = getMinMaxValues;
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };

});
define(<span class="string">'mixins/data'</span>, [
  <span class="string">"d3"</span>
], <span class="function"><span class="keyword">function</span> <span class="params">(d3)</span> {</span>

  <span class="function"><span class="keyword">function</span> <span class="title">dataIdentifier</span> <span class="params">(d)</span> {</span>
    <span class="keyword">return</span> d[<span class="number">0</span>];
  }

  <span class="function"><span class="keyword">function</span> <span class="title">setDelay</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> __ = <span class="keyword">this</span>.__,
        duration = __.duration,
        data = __.data;
    <span class="keyword">if</span> (duration == <span class="literal">undefined</span>) { <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'__.duration unset'</span>)}
    __.delay = <span class="function"><span class="keyword">function</span> <span class="params">(d, i)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>FIXME: only referring to the first dataset, 
while setting the delay on all!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">return</span> i / data[<span class="number">0</span>].length * duration;
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };

  <span class="function"><span class="keyword">function</span> <span class="title">normalizeData</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> data = <span class="keyword">this</span>.selection.datum(),
        __ = <span class="keyword">this</span>.__,
        parsed_data = [],
        date_chart = __.x_scale == <span class="string">'time'</span> ? <span class="literal">true</span> : <span class="literal">false</span>,
        date_format = __.date_format,
        date_type = __.date_type,
        categoricalValue = __.categoricalValue;
    data.forEach( <span class="function"><span class="keyword">function</span> <span class="params">(dataset, index)</span> {</span>
      <span class="keyword">if</span> (date_chart) {
        parsed_data.push(dataset.map(<span class="function"><span class="keyword">function</span><span class="params">(d, i)</span> {</span>
          <span class="keyword">var</span> x;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>The time data is encoded in a string:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">if</span> (date_chart &amp;&amp; date_type == <span class="string">'string'</span>) {
            x = d3.time.format(date_format)
              .parse(categoricalValue.call(dataset, d));</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>The time data is encoded in an epoch number:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          } <span class="keyword">else</span> <span class="keyword">if</span> (date_chart &amp;&amp; __.date_type == <span class="string">'epoch'</span>) {
            x = <span class="keyword">new</span> Date(categoricalValue.call(dataset, d) * <span class="number">1000</span>);
          } 
          <span class="keyword">return</span> [x, __.quantativeValue.call(dataset, d)];
        }));
      } <span class="keyword">else</span> {
        dataset = __.invert_data ? dataset.reverse() : dataset;
        parsed_data.push(dataset.map(<span class="function"><span class="keyword">function</span><span class="params">(d, i)</span> {</span>
          <span class="keyword">var</span> x = __.categoricalValue.call(dataset, d);
          <span class="keyword">return</span> [x, __.quantativeValue.call(dataset, d)];
        }));
      }
    });
    __.data = parsed_data;
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">this</span>.dataIdentifier = dataIdentifier;
    <span class="keyword">this</span>.setDelay = setDelay;
    <span class="keyword">this</span>.normalizeData = normalizeData;
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };

});


define(<span class="string">'mixins/layout'</span>, [
  <span class="string">"d3"</span>
], <span class="function"><span class="keyword">function</span> <span class="params">(d3)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>TODO: unit test.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">setDimensions</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> __ = <span class="keyword">this</span>.__;
    <span class="keyword">if</span> ( __.width === <span class="literal">undefined</span> ) {
      __.width  = +<span class="keyword">this</span>.selection.style(<span class="string">'width'</span>).replace(<span class="string">'px'</span>, <span class="string">''</span>);
      __.height = __.height || __.width * __.ratio;
    } <span class="keyword">else</span> <span class="keyword">if</span> ( __.width &amp;&amp; __.height === <span class="literal">undefined</span>) {
      __.height = __.width * __.ratio;
    }
    <span class="keyword">this</span>.setW();
    <span class="keyword">this</span>.setH();
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  <span class="function"><span class="keyword">function</span> <span class="title">setW</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> __ = <span class="keyword">this</span>.__;
    __.w   = __.width - __.margin.right - __.margin.left;
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };
      
  <span class="function"><span class="keyword">function</span> <span class="title">setH</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> __ = <span class="keyword">this</span>.__;
    __.h   = __.height - __.margin.top - __.margin.bottom;
    <span class="keyword">return</span> <span class="keyword">this</span>; 
  };

  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">this</span>.setDimensions = setDimensions;
    <span class="keyword">this</span>.setW = setW;
    <span class="keyword">this</span>.setH = setH;
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };

});

define(<span class="string">'mixins/scale'</span>, [
  <span class="string">"d3"</span>,
  <span class="string">"utils/mixins"</span>,
], <span class="function"><span class="keyword">function</span> <span class="params">(d3, utils_mixins)</span> {</span>

  <span class="function"><span class="keyword">function</span> <span class="title">_getRange</span> <span class="params">(axis, __)</span> {</span>
    <span class="keyword">if</span> ( axis == <span class="string">'x'</span>) {
      <span class="keyword">return</span> [<span class="number">0</span>, __.w];
    } <span class="keyword">else</span> <span class="keyword">if</span> ( axis == <span class="string">'y'</span>) {
      <span class="keyword">return</span> [__.h, <span class="number">0</span>];
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>It assumes the data is correctly sorted.
TODO: Guard against axis argument == null or undefined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_getDomain</span> <span class="params">(data, axis)</span> {</span>
    <span class="keyword">var</span> d0 = <span class="literal">Infinity</span>, 
        d1 = <span class="number">0</span>, 
        index = axis == <span class="string">'x'</span> ? <span class="number">0</span> : <span class="number">1</span>;
    data.forEach( <span class="function"><span class="keyword">function</span> <span class="params">(dataset, i)</span> {</span>
      <span class="keyword">if</span> (dataset[<span class="number">0</span>][index] &lt; d0) {
        d0 = dataset[<span class="number">0</span>][index];
      }
      <span class="keyword">if</span> (dataset[dataset.length - <span class="number">1</span>][index] &gt; d1) {
        d1 = dataset[dataset.length - <span class="number">1</span>][index];
      }
    });
    <span class="keyword">return</span> [d0, d1];
  }

  <span class="function"><span class="keyword">function</span> <span class="title">_setScale</span> <span class="params">(scale_type)</span> {</span>
    <span class="keyword">switch</span> (scale_type) {
      <span class="keyword">case</span> <span class="literal">undefined</span>:
        <span class="keyword">return</span>;
      <span class="keyword">case</span> <span class="string">'ordinal'</span>:
        <span class="keyword">return</span> d3.scale.ordinal;
      <span class="keyword">case</span> <span class="string">'linear'</span>:
        <span class="keyword">return</span> d3.scale.linear;
      <span class="keyword">case</span> <span class="string">'time'</span>:
        <span class="keyword">return</span> d3.time.scale;
      <span class="keyword">default</span>:
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'scale_type `'</span>
          + scale_type
          + <span class="string">'` is not supported. Supported types are: ordinal, linear, time'</span> );
    }
  }

  <span class="function"><span class="keyword">function</span> <span class="title">setScales</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> __ = <span class="keyword">this</span>.__;
    __.xScale = <span class="keyword">this</span>._setScale(__.x_scale)();
    __.yScale = <span class="keyword">this</span>._setScale(__.y_scale)();
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>TODO: throw on wrong input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_parseScaleBounds</span> <span class="params">(bounds, __)</span> {</span>
    <span class="keyword">var</span> min_max = getMinMaxValues(__.data);
    bounds = bounds.split(<span class="string">','</span>);
    <span class="keyword">if</span> (bounds[<span class="number">0</span>] == <span class="string">'min'</span>) { 
      bounds[<span class="number">0</span>] = min_max.min; 
    } <span class="keyword">else</span> {
      bounds[<span class="number">0</span>] = +bounds[<span class="number">0</span>];
    }
    <span class="keyword">if</span> (bounds[<span class="number">1</span>] == <span class="string">'max'</span>) {
      bounds[<span class="number">1</span>] = min_max.max; 
    } <span class="keyword">else</span> {
      bounds[<span class="number">1</span>] = +bounds[<span class="number">1</span>];
    }
    <span class="keyword">return</span> bounds;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Sets the range and domain for the linear scale.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_applyLinearScale</span> <span class="params">(range, __)</span> {</span>
    <span class="keyword">var</span> scale_bounds = __.scale_bounds,
        min_max = _parseScaleBounds(scale_bounds, __);  
    <span class="keyword">return</span> <span class="keyword">this</span>.range(range).domain(min_max);
  }

  <span class="function"><span class="keyword">function</span> <span class="title">_applyTimeScale</span> <span class="params">(range, __)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>see <a href="http://bl.ocks.org/mbostock/6186172">bl.ocks.org/mbostock/6186172</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> data = __.data,
        domain = _getDomain(data, <span class="string">'x'</span>),
        t1 = domain[<span class="number">0</span>],
        t2 = domain[<span class="number">1</span>],
        offset = __.date_offset,
        t0,
        t3;
    <span class="keyword">if</span> (__.date_offset) {
      t0 = d3.time[offset].offset(t1, -<span class="number">1</span>);
      t3 = d3.time[offset].offset(t2, +<span class="number">1</span>);
      <span class="keyword">return</span> <span class="keyword">this</span>
        .domain([t0, t3])
        .range([t0, t3].map(d3.time.scale()
          .domain([t1, t2])
          .range([<span class="number">0</span>, __.w])));
    } <span class="keyword">else</span> {
      <span class="keyword">return</span> <span class="keyword">this</span>.range(range).domain(domain);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Sets the range and domain for the ordinal scale.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_applyOrdinalScale</span> <span class="params">(range, __)</span> {</span>
    <span class="keyword">var</span> data = __.x_axis_data || __.data;  <span class="comment">// FIXME this hack!</span>
    <span class="keyword">return</span> <span class="keyword">this</span>
      .rangeRoundBands(range, __.padding)
      .domain( __.data[<span class="number">0</span>].map( <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d[<span class="number">0</span>]; } ) );
  }

  <span class="function"><span class="keyword">function</span> <span class="title">_applyScale</span> <span class="params">(axis, scale_type, __)</span> {</span>
    <span class="keyword">var</span> range = _getRange(axis, __);
    <span class="keyword">switch</span> (scale_type) {
      <span class="keyword">case</span> <span class="string">'ordinal'</span>:
        <span class="keyword">return</span> _applyOrdinalScale.call(<span class="keyword">this</span>, range, __);
      <span class="keyword">case</span> <span class="string">'linear'</span>:
        <span class="keyword">return</span> _applyLinearScale.call(<span class="keyword">this</span>, range, __);
      <span class="keyword">case</span> <span class="string">'time'</span>:
        <span class="keyword">return</span> _applyTimeScale.call(<span class="keyword">this</span>, range, __);
      <span class="keyword">case</span> <span class="literal">undefined</span>:
        <span class="keyword">return</span> <span class="keyword">new</span> Error(<span class="string">'scale cannot be undefined'</span>);
      <span class="keyword">default</span>:
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'scale_type '</span> 
                         + scale_type 
                         + <span class="string">' not supported. Is it misspelled?'</span> );
    }
  }

  <span class="function"><span class="keyword">function</span> <span class="title">applyScales</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> __ = <span class="keyword">this</span>.__;
    <span class="keyword">this</span>.applyScale.call( __.xScale, <span class="string">'x'</span>, __.x_scale, __ );
    <span class="keyword">this</span>.applyScale.call( __.yScale, <span class="string">'y'</span>, __.y_scale, __ );
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

    <span class="keyword">this</span>.setScales = setScales;
    <span class="keyword">this</span>.applyScales = applyScales;
    <span class="keyword">this</span>.applyScale = _applyScale;</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>private methods, exposed for testing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>._setScale = _setScale;
    <span class="keyword">this</span>._applyLinearScale = _applyLinearScale;
    <span class="keyword">this</span>._getRange = _getRange;
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };

});


define(<span class="string">'mixins/axis'</span>, [
  <span class="string">"d3"</span>
], <span class="function"><span class="keyword">function</span> <span class="params">(d3)</span> {</span>

  <span class="function"><span class="keyword">function</span> <span class="title">_setProps</span> <span class="params">(axis_conf, scale)</span> {</span> 
    <span class="keyword">if</span> ( !axis_conf.show ) { <span class="keyword">return</span>; }
    <span class="keyword">var</span> axis = d3.svg.axis().scale(scale);
    d3.entries(axis_conf).forEach(<span class="function"><span class="keyword">function</span><span class="params">(o)</span> {</span>
      <span class="keyword">if</span> ( o.value !== <span class="literal">undefined</span> &amp;&amp; o.key !== <span class="string">'show'</span> ) {
        axis[o.key](o.value);
      }
    });
    <span class="keyword">return</span> axis;
  }

  <span class="function"><span class="keyword">function</span> <span class="title">setAxes</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> __ = <span class="keyword">this</span>.__;
    __.xAxis = <span class="keyword">this</span>._setProps(__.x_axis, __.xScale);
    __.yAxis = <span class="keyword">this</span>._setProps(__.y_axis, __.yScale);
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  <span class="function"><span class="keyword">function</span> <span class="title">_transitionXAxisV</span> <span class="params">(__)</span> {</span>
    <span class="keyword">return</span> <span class="keyword">this</span>
      .attr(<span class="string">"transform"</span>, <span class="string">"translate("</span> + __.offset_x + <span class="string">","</span> + __.yScale.range()[<span class="number">0</span>] + <span class="string">")"</span>)
      .call(__.xAxis);
  }

  <span class="function"><span class="keyword">function</span> <span class="title">_transitionXAxisH</span> <span class="params">(__)</span> {</span>
    <span class="keyword">return</span> <span class="keyword">this</span>
      .attr(<span class="string">"transform"</span>, <span class="string">"translate("</span> + __.offset_x + <span class="string">","</span> + __.h + <span class="string">")"</span>)
      .call(__.xAxis);
  }

  <span class="function"><span class="keyword">function</span> <span class="title">_transitionXAxis</span> <span class="params">(__)</span> {</span>
    <span class="keyword">if</span> ( !__.x_axis.show ) { <span class="keyword">return</span>; }
    <span class="keyword">if</span> (__.quantitative_scale == <span class="string">'y'</span>) {
      <span class="keyword">return</span> _transitionXAxisV.call(<span class="keyword">this</span>, __);
    } <span class="keyword">else</span> <span class="keyword">if</span> (__.quantitative_scale == <span class="string">'x'</span>) {
      <span class="keyword">return</span> _transitionXAxisH.call(<span class="keyword">this</span>, __);
    } <span class="keyword">else</span> {
      <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'quantitative_scale must be one of: x, y'</span>);
    } 
  }

  <span class="function"><span class="keyword">function</span> <span class="title">_transitionYAxis</span> <span class="params">(__)</span> {</span>
    <span class="keyword">if</span> ( !__.y_axis.show ) { <span class="keyword">return</span>; }
    <span class="keyword">return</span> <span class="keyword">this</span>
      .attr(<span class="string">"transform"</span>, <span class="string">"translate(0,-"</span> + __.offset_y + <span class="string">")"</span>)
      .call(__.yAxis)
      .selectAll(<span class="string">"g"</span>)
      .delay( __.delay );
  }

  <span class="function"><span class="keyword">function</span> <span class="title">transitionAxis</span> <span class="params">(axis, __)</span> {</span>
    <span class="keyword">switch</span> (axis) {
      <span class="keyword">case</span> <span class="string">'x'</span>:
        <span class="keyword">return</span> _transitionXAxis.call(<span class="keyword">this</span>, __);
      <span class="keyword">case</span> <span class="string">'y'</span>:
        <span class="keyword">return</span> _transitionYAxis.call(<span class="keyword">this</span>, __);
      <span class="keyword">default</span>:
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'axis must be one of: x, y. Not '</span> + axis );
    } 
  } 

  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">this</span>.setAxes = setAxes;
    <span class="keyword">this</span>._setProps = _setProps;
    <span class="keyword">this</span>.transitionAxis = transitionAxis;
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };

});
define(<span class="string">'mixins/chart'</span>, [
  <span class="string">"d3"</span>
], <span class="function"><span class="keyword">function</span> <span class="params">(d3)</span> {</span>

  <span class="function"><span class="keyword">function</span> <span class="title">setChart</span> <span class="params">(chart_class)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>console.log(selection[0].tagName.toLowerCase())</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> self = <span class="keyword">this</span>,
        __   = self.__;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Select the svg element, if it exists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.svg = self.selection.selectAll(<span class="string">"svg"</span>).data([__.data]);</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Otherwise, create the skeletal chart.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.gEnter = self.svg.enter().append(<span class="string">"svg"</span>)
      .append(<span class="string">"g"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Initializing the tooltip.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> ( __.tooltip ) {
      self.tip = self.tip( __.tooltip );
      self.gEnter.call(self.tip);
    }
   
    self.gEnter.append(<span class="string">"g"</span>).attr(<span class="string">"class"</span>, chart_class);</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>TODO: we need to handle bar offsets and others?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    __.overlapping_charts.names.forEach( <span class="function"><span class="keyword">function</span> <span class="params">(chart_name)</span> {</span>
      self.gEnter.append(<span class="string">"g"</span>).attr(<span class="string">"class"</span>, chart_name);
    });

    self.gEnter.append(<span class="string">"g"</span>).attr(<span class="string">"class"</span>, <span class="string">"x axis"</span>);
    self.gEnter.append(<span class="string">"g"</span>).attr(<span class="string">"class"</span>, <span class="string">"y axis"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Update the outer dimensions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.svg.attr(<span class="string">"width"</span>, __.width)
      .attr(<span class="string">"height"</span>, __.height);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Update the inner dimensions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.g = self.svg.select(<span class="string">"g"</span>)
      .attr(<span class="string">"transform"</span>, <span class="string">"translate("</span> + 
      __.margin.left + <span class="string">","</span> + __.margin.top + <span class="string">")"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Transitions root.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.transition = self.g.transition().duration(__.duration);</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Update the y axis.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.transitionAxis.call(
      self.transition.selectAll(<span class="string">'.y.axis'</span>), <span class="string">'y'</span>, __);</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Update the x axis.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.transitionAxis.call(
      self.transition.selectAll(<span class="string">'.x.axis'</span>), <span class="string">'x'</span>, __);

    <span class="keyword">return</span> self;
  };

  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">this</span>.setChart = setChart;
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };

});</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p><strong>The default configuration module for the bar.bar module</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>define(<span class="string">'bar/config'</span>, [
  <span class="string">"base_config"</span>,
  <span class="string">"utils/mixins"</span>,
], <span class="function"><span class="keyword">function</span><span class="params">(base_config, utils_mixins)</span> {</span>
    
  <span class="keyword">var</span> config = {
        orientation: <span class="string">'vertical'</span>,
        padding: <span class="number">.1</span>
      },
      utils = utils_mixins();

  <span class="keyword">return</span> utils.extend(base_config, config);
  
});


define(<span class="string">'bar/mixins'</span>,[<span class="string">"d3"</span>], <span class="function"><span class="keyword">function</span><span class="params">(d3)</span> {</span>

    <span class="function"><span class="keyword">function</span> <span class="title">_getBarOrientation</span> <span class="params">(__)</span> {</span>
      <span class="keyword">if</span> ( (__.x_scale == <span class="string">'ordinal'</span> || __.x_scale == <span class="string">'time'</span>) &amp;&amp;
            __.y_scale == <span class="string">'linear'</span>) {
        <span class="keyword">return</span> <span class="string">'vertical'</span>;
      } <span class="keyword">else</span> <span class="keyword">if</span> (__.x_scale == <span class="string">'linear'</span> &amp;&amp; __.y_scale == <span class="string">'ordinal'</span>) {
        <span class="keyword">return</span> <span class="string">'horizontal'</span>;
      } <span class="keyword">else</span> {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'x_scale-y_scale wrong options combination'</span>);
      }
    }

    <span class="function"><span class="keyword">function</span> <span class="title">_createVerticalBars</span> <span class="params">(__)</span> {</span>
      <span class="keyword">return</span> <span class="keyword">this</span>.append(<span class="string">"rect"</span>)
        .attr(<span class="string">"class"</span>, <span class="string">"bar"</span>)
        .attr(<span class="string">"x"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> __.xScale(d[<span class="number">0</span>]); })
        .attr(<span class="string">"width"</span>, __.xScale.rangeBand())
        .attr(<span class="string">"y"</span>, __.h)
        .attr(<span class="string">"height"</span>, <span class="number">0</span>);
    }

    <span class="function"><span class="keyword">function</span> <span class="title">_createTimeBars</span> <span class="params">(__)</span> {</span>
      <span class="keyword">return</span> <span class="keyword">this</span>.append(<span class="string">"rect"</span>)
        .attr(<span class="string">"class"</span>, <span class="string">"bar"</span>)
        .attr(<span class="string">"x"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span>
          <span class="keyword">return</span> __.xScale(d[<span class="number">0</span>]) - __.bar_width / <span class="number">2</span>;
        })
        .attr(<span class="string">"width"</span>, __.bar_width)</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>attention TODO: this get then overridden by the transition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        .attr(<span class="string">"y"</span>, __.h) 
        .attr(<span class="string">"height"</span>, <span class="number">0</span>);
    }

    <span class="function"><span class="keyword">function</span> <span class="title">_createHorizontalBars</span> <span class="params">(__)</span> {</span>
      <span class="keyword">return</span> <span class="keyword">this</span>.append(<span class="string">"rect"</span>)
        .attr(<span class="string">"class"</span>, <span class="string">"bar"</span>)
        .attr(<span class="string">"x"</span>)
        .attr(<span class="string">"width"</span>, <span class="number">0</span>)
        .attr(<span class="string">"y"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> __.yScale(d[<span class="number">0</span>]); })
        .attr(<span class="string">"height"</span>, __.yScale.rangeBand());
    }

    <span class="function"><span class="keyword">function</span> <span class="title">createBars</span> <span class="params">(__)</span> {</span>
      <span class="keyword">var</span> orientation = _getBarOrientation(__);
      <span class="keyword">if</span> (orientation == <span class="string">'vertical'</span> &amp;&amp; __.x_scale !== <span class="string">'time'</span>) {
        <span class="keyword">return</span> _createVerticalBars.call(<span class="keyword">this</span>, __);
      } <span class="keyword">else</span> <span class="keyword">if</span> (orientation == <span class="string">'vertical'</span> &amp;&amp; __.x_scale == <span class="string">'time'</span>) {
        <span class="keyword">return</span> _createTimeBars.call(<span class="keyword">this</span>, __);
      } <span class="keyword">else</span> <span class="keyword">if</span> (orientation == <span class="string">'horizontal'</span>) {
        <span class="keyword">return</span> _createHorizontalBars.call(<span class="keyword">this</span>, __);
      } <span class="keyword">else</span> {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"orientation-x_scale wrong combination"</span>);
      }
    }

    <span class="function"><span class="keyword">function</span> <span class="title">_transitionVerticalBars</span> <span class="params">(__)</span> {</span>
      <span class="keyword">return</span> <span class="keyword">this</span>.delay(__.delay)
        .attr(<span class="string">"x"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> __.xScale(d[<span class="number">0</span>]) + __.offset_x; })
        .attr(<span class="string">"y"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> __.yScale(d[<span class="number">1</span>]) - __.offset_y; })
        .attr(<span class="string">"height"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> __.h - __.yScale(d[<span class="number">1</span>]); });
    }

    <span class="function"><span class="keyword">function</span> <span class="title">_transitionTimeBars</span> <span class="params">(__)</span> {</span>
      <span class="keyword">return</span> <span class="keyword">this</span>.delay(__.delay)
        .attr(<span class="string">"x"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> 
          <span class="keyword">return</span> __.xScale(d[<span class="number">0</span>]) + __.offset_x - __.bar_width / <span class="number">2</span>;
        })
        .attr(<span class="string">"y"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> __.yScale(d[<span class="number">1</span>]) - __.offset_y; })
        .attr(<span class="string">"height"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> __.h - __.yScale(d[<span class="number">1</span>]); });
    }

    <span class="function"><span class="keyword">function</span> <span class="title">_transitionHorizontalBars</span> <span class="params">(__)</span> {</span>
      <span class="keyword">return</span> <span class="keyword">this</span>.delay(__.delay)
        .attr(<span class="string">"y"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> __.yScale(d[<span class="number">0</span>]) - __.offset_y; })
        .attr(<span class="string">"x"</span>, __.offset_x)
        .attr(<span class="string">"width"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> 
          <span class="keyword">return</span> __.xScale(d[<span class="number">1</span>]) + __.offset_x; 
        });
    }

    <span class="function"><span class="keyword">function</span> <span class="title">transitionBars</span> <span class="params">(orientation, __)</span> {</span>
      <span class="keyword">var</span> orientation = _getBarOrientation(__);
      <span class="keyword">if</span> (orientation == <span class="string">'vertical'</span> &amp;&amp; __.x_scale !== <span class="string">'time'</span>) {
        <span class="keyword">return</span> _transitionVerticalBars.call(<span class="keyword">this</span>, __);
      } <span class="keyword">else</span> <span class="keyword">if</span> (orientation == <span class="string">'vertical'</span> &amp;&amp; __.x_scale == <span class="string">'time'</span>) {
        <span class="keyword">return</span> _transitionTimeBars.call(<span class="keyword">this</span>, __);
      } <span class="keyword">else</span> <span class="keyword">if</span> (orientation == <span class="string">'horizontal'</span>) {
        <span class="keyword">return</span> _transitionHorizontalBars.call(<span class="keyword">this</span>, __);
      } <span class="keyword">else</span> {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"orientation-x_scale wrong combination"</span>);
      }
    }

    <span class="function"><span class="keyword">function</span> <span class="title">setBars</span> <span class="params">()</span> {</span>
      <span class="keyword">var</span> self = <span class="keyword">this</span>,
          __ = <span class="keyword">this</span>.__;

      __.data.forEach( <span class="function"><span class="keyword">function</span> <span class="params">(data, i)</span> {</span>
        <span class="keyword">var</span> bars = self.g.select(<span class="string">'.bars'</span>).selectAll(<span class="string">".bar"</span>)
              .data(data, self.dataIdentifier),
            ov_options = __.overlapping_charts.options,
            ov_bar_options = ov_options ? ov_options.bars : <span class="keyword">void</span> <span class="number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Exit phase (pushes out old bars before new ones come in).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        bars.exit()
          .transition().duration(__.duration).style(<span class="string">'opacity'</span>, <span class="number">0</span>).remove();
  
        self.createBars.call(bars.enter(), __)
          .on(<span class="string">'click'</span>, __.handleClick);</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>And transition them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        self.transitionBars
          .call(self.transition.selectAll(<span class="string">'.bar'</span>), __.orientation, __)
          .call(self.endall, data, __.handleTransitionEnd);
    
        <span class="keyword">if</span> (__.tooltip) {
          bars
           .on(<span class="string">'mouseover'</span>, self.tip.show)
           .on(<span class="string">'mouseout'</span>, self.tip.hide);
        }
      });

    }

    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(orientation, __)</span> {</span>
      <span class="keyword">this</span>.setBars = setBars;
      <span class="keyword">this</span>.transitionBars = transitionBars;
      <span class="keyword">this</span>.createBars = createBars;
      <span class="keyword">return</span> <span class="keyword">this</span>;
    };

});</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p><strong>The bar.bar module</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>define(<span class="string">'bar/bar'</span>,[
  <span class="string">"d3"</span>, 
  <span class="string">"utils/mixins"</span>,
  <span class="string">"bar/config"</span>, 
  <span class="string">"mixins/data"</span>,
  <span class="string">"mixins/layout"</span>,
  <span class="string">"mixins/scale"</span>,
  <span class="string">"mixins/axis"</span>,
  <span class="string">"mixins/chart"</span>,
  <span class="string">"bar/mixins"</span>,
], <span class="function"><span class="keyword">function</span><span class="params">(
  d3, 
  utils_mixins, 
  default_config, 
  data_mixins,
  layout_mixins,
  scale_mixins,
  axis_mixins,
  chart_mixins,
  bar_mixins
)</span> {</span>
  
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(user_config)</span> {</span>

    <span class="keyword">var</span> config = user_config || {},
        utils  = utils_mixins(),
        extend = utils.extend,
        getset = utils.getset,
        __     = extend(default_config, config);

    <span class="function"><span class="keyword">function</span> <span class="title">Bar</span> <span class="params">(selection)</span> {</span>

      <span class="keyword">var</span> self = <span class="keyword">this</span> <span class="keyword">instanceof</span> Bar
               ? <span class="keyword">this</span>
               : <span class="keyword">new</span> Bar(selection),
          has_timescale = __.x_scale == <span class="string">'time'</span>,
          bars;

      self.__        = __;
      self.selection = selection;

      self.normalizeData();
      self.setDimensions();

      <span class="keyword">if</span> (has_timescale) { self.adjustDimensionsToTimeScale(); }

      self.setScales();
      self.setAxes();
      self.setDelay();
      self.applyScales();
      self.setChart(<span class="string">'bars'</span>);
      self.setBars();</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <pre><code> __.overlapping_charts.names.forEach( function (chart_name) {
   utils.getScaffoldingMethod.call(self, chart_name).call(self, __);
 });</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">return</span> selection;
    }

    getset(Bar, __);
    utils_mixins.call(Bar.prototype);
    data_mixins.call(Bar.prototype);
    layout_mixins.call(Bar.prototype);
    scale_mixins.call(Bar.prototype);
    axis_mixins.call(Bar.prototype);
    chart_mixins.call(Bar.prototype);
    bar_mixins.call(Bar.prototype);

    Bar.prototype.adjustDimensionsToTimeScale = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      __.bar_width = (__.w / __.data[<span class="number">0</span>].length) * <span class="number">.9</span>;
      __.width += __.bar_width + __.offset_x; <span class="comment">//FIXME: this should be smarter!</span>
      offset_x = __.offset_x == <span class="number">0</span> ? __.bar_width * <span class="number">.6</span> : __.offset_x;
      __.margin = utils.extend(__.margin, {
          left: __.margin.left + offset_x,
          right: __.margin.right + offset_x
      });
      <span class="keyword">return</span> <span class="keyword">this</span>;
    }

    <span class="keyword">return</span> Bar;
  }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p><strong>The default configuration module for the line.line module</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>define(<span class="string">'line/config'</span>,[
  <span class="string">"d3"</span>, 
  <span class="string">"base_config"</span>,
  <span class="string">"utils/mixins"</span>,
], <span class="function"><span class="keyword">function</span><span class="params">(d3, base_config, utils_mixins)</span> {</span>
    
  <span class="keyword">var</span> config = {
        x_scale: <span class="string">'time'</span>,
      },
      utils = utils_mixins();

  <span class="keyword">return</span> utils.extend(base_config, config);
  
});


define(<span class="string">'line/mixins'</span>, [<span class="string">"d3"</span>], <span class="function"><span class="keyword">function</span> <span class="params">(d3)</span> {</span>

  <span class="function"><span class="keyword">function</span> <span class="title">setLines</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> self = <span class="keyword">this</span>,
          __ = <span class="keyword">this</span>.__;</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Select the line elements, if they exists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.lines_g = self.g.select(<span class="string">'g.lines'</span>).selectAll(<span class="string">".lines"</span>)
      .data(__.data, self.dataIdentifier);</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Exit phase (let us push out old lines before the new ones come in).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.lines_g.exit()
      .transition().duration(__.duration).style(<span class="string">'opacity'</span>, <span class="number">0</span>).remove();</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Otherwise, create them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.lines_g.enter().append(<span class="string">"g"</span>).each( <span class="function"><span class="keyword">function</span> <span class="params">(data, i)</span> {</span>
      <span class="keyword">var</span> lines = d3.select(<span class="keyword">this</span>).selectAll(<span class="string">".line"</span>)
            .data([data], self.dataIdentifier),
          ov_options = __.overlapping_charts.options,
          ov_line_options = ov_options ? ov_options.bars : <span class="keyword">void</span> <span class="number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Exit phase (let us push out old lines before the new ones come in).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      lines.exit()
        .transition().duration(__.duration).style(<span class="string">'opacity'</span>, <span class="number">0</span>).remove();      

      lines.enter().append(<span class="string">"path"</span>)
        .attr(<span class="string">"class"</span>, <span class="string">"line"</span>)
        .attr(<span class="string">"d"</span>, self.line(__) )
        .on(<span class="string">'click'</span>, __.handleClick);
      
      <span class="keyword">if</span> (__.tooltip) {
        lines
         .on(<span class="string">'mouseover'</span>, self.tip.show)
         .on(<span class="string">'mouseout'</span>, self.tip.hide);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>TODO
And transition them.
self.transitionLines
 .call(transition.selectAll(&#39;.line&#39;), &#39;vertical&#39;, params)
 .call(utils.endall, data, __.handleTransitionEnd);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    });

    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">this</span>.setLines = setLines;
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };

});


define(<span class="string">'circle/mixins'</span>, [<span class="string">"d3"</span>], <span class="function"><span class="keyword">function</span> <span class="params">(d3, utils)</span> {</span>

  <span class="function"><span class="keyword">function</span> <span class="title">setCircles</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> self = <span class="keyword">this</span>,
          __ = <span class="keyword">this</span>.__;</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Select the circle elements, if they exists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.circles_g = self.g.select(<span class="string">'g.circles'</span>).selectAll(<span class="string">".circles"</span>)
      .data(__.data, self.dataIdentifier);</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Exit phase (let us push out old circles before the new ones come in).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.circles_g.exit()
      .transition().duration(__.duration).style(<span class="string">'opacity'</span>, <span class="number">0</span>).remove();</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Otherwise, create them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.circles_g.enter().append(<span class="string">"g"</span>).each( <span class="function"><span class="keyword">function</span> <span class="params">(data, i)</span> {</span>
      <span class="keyword">var</span> circles = d3.select(<span class="keyword">this</span>).selectAll(<span class="string">".circle"</span>)
            .data(data, self.dataIdentifier),
          tip,
          ov_options = __.overlapping_charts.options,
          ov_circle_options = ov_options ? ov_options.circles : <span class="keyword">void</span> <span class="number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Exit phase (let us push out old circles before the new ones come in).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      circles.exit()
        .transition().duration(__.duration).style(<span class="string">'opacity'</span>, <span class="number">0</span>).remove();</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Otherwise, create them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      circles.enter().append(<span class="string">"circle"</span>)
        .attr(<span class="string">"class"</span>, <span class="string">"dot"</span>)
        .attr(<span class="string">"r"</span>, ov_circle_options &amp;&amp; ov_circle_options.r ? ov_circle_options.r : <span class="number">4</span>)
        .attr(<span class="string">"cx"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> __.xScale(d[<span class="number">0</span>]); })
        .attr(<span class="string">"cy"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> __.yScale(d[<span class="number">1</span>]); })</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>TODO: this will need a fix if is an overlapping chart!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        .on(<span class="string">'click'</span>, __.handleClick);</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Tooltips.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (ov_circle_options &amp;&amp; ov_circle_options.tooltip) {
        tip = self.tip( ov_circle_options.tooltip );
        self.gEnter.call(tip);
      }
      <span class="keyword">if</span> (__.tooltip || ov_circle_options &amp;&amp; ov_circle_options.tooltip) {
        tip = tip || self.tip;
        circles
         .on(<span class="string">'mouseover'</span>, tip.show)
         .on(<span class="string">'mouseout'</span>, tip.hide);
      }

    });</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>TODO
And transition them.
self.transitionCircles
 .call(transition.selectAll(&#39;.circle&#39;), &#39;vertical&#39;, params)
 .call(utils.endall, data, __.handleTransitionEnd);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">this</span>.setCircles = setCircles;
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };

});</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p><strong>The line.line module</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>define(<span class="string">'line/line'</span>,[
  <span class="string">"d3"</span>, 
  <span class="string">"utils/mixins"</span>,
  <span class="string">"line/config"</span>, 
  <span class="string">"mixins/data"</span>,
  <span class="string">"mixins/layout"</span>,
  <span class="string">"mixins/scale"</span>,
  <span class="string">"mixins/axis"</span>,
  <span class="string">"mixins/chart"</span>,
  <span class="string">"line/mixins"</span>,
  <span class="string">"circle/mixins"</span>,
], <span class="function"><span class="keyword">function</span><span class="params">(
  d3, 
  utils_mixins, 
  default_config, 
  data_mixins,
  layout_mixins,
  scale_mixins,
  axis_mixins,
  chart_mixins,
  line_mixins,
  circle_mixins
)</span> {</span>
  
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(user_config)</span> {</span>

    <span class="keyword">var</span> config = user_config || {},
        utils  = utils_mixins(),
        extend = utils.extend,
        getset = utils.getset,
        __     = extend(default_config, config);

    <span class="function"><span class="keyword">function</span> <span class="title">Line</span> <span class="params">(selection)</span> {</span>

      <span class="keyword">var</span> self = <span class="keyword">this</span> <span class="keyword">instanceof</span> Line
               ? <span class="keyword">this</span>
               : <span class="keyword">new</span> Line(selection),
          has_timescale = __.x_scale == <span class="string">'time'</span>,
          lines;

      self.__ = __;
      self.selection = selection;

      self.normalizeData();
      self.setDimensions();
      self.setScales();
      self.setAxes();
      self.setDelay();
      self.applyScales();
      self.setChart(<span class="string">'lines'</span>);
      self.setLines();

      __.overlapping_charts.names.forEach( <span class="function"><span class="keyword">function</span> <span class="params">(chart_name)</span> {</span>
        utils.getGraphHelperMethod.call(self, chart_name).call(self, __);
      });

      <span class="keyword">return</span> selection;
    }

    getset(Line, __);
    utils_mixins.call(Line.prototype);
    data_mixins.call(Line.prototype);
    layout_mixins.call(Line.prototype);
    scale_mixins.call(Line.prototype);
    axis_mixins.call(Line.prototype);
    chart_mixins.call(Line.prototype);
    line_mixins.call(Line.prototype);
    circle_mixins.call(Line.prototype);

    Line.prototype.line = <span class="function"><span class="keyword">function</span> <span class="params">(__)</span> {</span>
      <span class="keyword">return</span> d3.svg.line().x(<span class="function"><span class="keyword">function</span><span class="params">(d, i)</span> {</span>
        <span class="keyword">return</span> __.xScale(d[<span class="number">0</span>]);
      }).y(<span class="function"><span class="keyword">function</span><span class="params">(d, i)</span> {</span>
        <span class="keyword">return</span> __.yScale(d[<span class="number">1</span>]);
      });
    }

    <span class="keyword">return</span> Line;
  }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p><strong>The default configuration module for the point.point module</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>define(<span class="string">'circle/config'</span>, [
  <span class="string">"base_config"</span>,
  <span class="string">"utils/mixins"</span>,
], <span class="function"><span class="keyword">function</span><span class="params">(base_config, utils_mixins)</span> {</span>
    
  <span class="keyword">var</span> config = {},
      utils = utils_mixins();

  <span class="keyword">return</span> utils.extend(base_config, config);
  
});</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p><strong>The circle.circle module</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>define(<span class="string">'circle/circle'</span>,[
  <span class="string">"d3"</span>, 
  <span class="string">"utils/mixins"</span>,
  <span class="string">"circle/config"</span>, 
  <span class="string">"mixins/data"</span>,
  <span class="string">"mixins/layout"</span>,
  <span class="string">"mixins/scale"</span>,
  <span class="string">"mixins/axis"</span>,
  <span class="string">"mixins/chart"</span>,
  <span class="string">"circle/mixins"</span>,
], <span class="function"><span class="keyword">function</span><span class="params">(
  d3, 
  utils_mixins, 
  default_config, 
  data_mixins,
  layout_mixins,
  scale_mixins,
  axis_mixins,
  chart_mixins,
  circle_mixins
)</span> {</span>
  
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(user_config)</span> {</span>

    <span class="keyword">var</span> config = user_config || {},
        utils  = utils_mixins(),
        extend = utils.extend,
        getset = utils.getset,
        __     = extend(default_config, config);

    <span class="function"><span class="keyword">function</span> <span class="title">Circle</span> <span class="params">(selection)</span> {</span>

      <span class="keyword">var</span> self = <span class="keyword">this</span> <span class="keyword">instanceof</span> Circle
               ? <span class="keyword">this</span>
               : <span class="keyword">new</span> Circle(selection),
          has_timescale = __.x_scale == <span class="string">'time'</span>,
          circles;

      self.__ = __;
      self.selection = selection;

      self.normalizeData();
      self.setDimensions();
      self.setScales();
      self.setAxes();
      self.setDelay();
      self.applyScales();
      self.setChart(<span class="string">'circles'</span>);
      self.setCircles();

      <span class="keyword">return</span> selection;
    }

    getset(Line, __);
    utils_mixins.call(Circle.prototype);
    data_mixins.call(Circle.prototype);
    layout_mixins.call(Circle.prototype);
    scale_mixins.call(Circle.prototype);
    axis_mixins.call(Circle.prototype);
    chart_mixins.call(Circle.prototype);
    circle_mixins.call(Circle.prototype);

    <span class="keyword">return</span> Circle;
  }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p><strong>frame.states module</strong></p>
<p>Used by the <em>frame.state_machine</em> module.
Name-spaced, might add other states if needed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>define(<span class="string">'frame/states'</span>,[<span class="string">'require'</span>],<span class="function"><span class="keyword">function</span><span class="params">(require)</span> {</span>

  <span class="keyword">var</span> transition_states = [
    {
      <span class="string">'name'</span>: <span class="string">'in_pause'</span>,
      <span class="string">'initial'</span>: <span class="literal">true</span>,
      <span class="string">'events'</span>: {
        <span class="string">'start'</span>: <span class="string">'in_transition_start'</span>,
        <span class="string">'next'</span>: <span class="string">'in_transition_next'</span>,
        <span class="string">'prev'</span>: <span class="string">'in_transition_prev'</span>,
        <span class="string">'jump'</span>: <span class="string">'in_transition_jump'</span>,
        <span class="string">'reset'</span>: <span class="string">'in_transition_reset'</span>
      }
    },
    {
      <span class="string">'name'</span>: <span class="string">'in_transition_start'</span>,
      <span class="string">'events'</span>: {
        <span class="string">'stop'</span>: <span class="string">'in_pause'</span>
      }
    },
    {
      <span class="string">'name'</span>: <span class="string">'in_transition_next'</span>,
      <span class="string">'events'</span>: {
        <span class="string">'stop'</span>: <span class="string">'in_pause'</span>
      }
    },
    {
      <span class="string">'name'</span>: <span class="string">'in_transition_prev'</span>,
      <span class="string">'events'</span>: {
        <span class="string">'stop'</span>: <span class="string">'in_pause'</span>
      }
    },
    {
      <span class="string">'name'</span>: <span class="string">'in_transition_jump'</span>,
      <span class="string">'events'</span>: {
        <span class="string">'stop'</span>: <span class="string">'in_pause'</span>
      }
    },
    {
      <span class="string">'name'</span>: <span class="string">'in_transition_reset'</span>,
      <span class="string">'events'</span>: {
        <span class="string">'stop'</span>: <span class="string">'in_pause'</span>
      }
    }
  ];

  <span class="keyword">return</span> { transition_states: transition_states};

});</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p><strong>frame.state_machine module</strong></p>
<p>From <a href="http://lamehacks.net/blog/implementing-a-state-machine-in-javascript/">http://lamehacks.net/blog/implementing-a-state-machine-in-javascript/</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>define(<span class="string">'frame/state_machine'</span>,[<span class="string">'require'</span>],<span class="function"><span class="keyword">function</span><span class="params">(require)</span> {</span>

  <span class="function"><span class="keyword">function</span> <span class="title">StateMachine</span> <span class="params">(states)</span> {</span>
    <span class="keyword">this</span>.states = states;
    <span class="keyword">this</span>.indexes = {};
    <span class="keyword">for</span>( <span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.states.length; i++) {
      <span class="keyword">this</span>.indexes[<span class="keyword">this</span>.states[i].name] = i;
      <span class="keyword">if</span> (<span class="keyword">this</span>.states[i].initial){
        <span class="keyword">this</span>.currentState = <span class="keyword">this</span>.states[i];
      }
    }
  }

  StateMachine.prototype.consumeEvent = <span class="function"><span class="keyword">function</span> <span class="params">(e)</span> {</span>
    <span class="keyword">if</span>(<span class="keyword">this</span>.currentState.events[e]){
      <span class="keyword">this</span>.currentState = <span class="keyword">this</span>.states[<span class="keyword">this</span>.indexes[<span class="keyword">this</span>.currentState.events[e]]];
    }
  }

  StateMachine.prototype.getStatus = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">return</span> <span class="keyword">this</span>.currentState.name;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>getLastEvent();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">return</span> StateMachine;

});</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p><strong>frame.frame module</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>define(<span class="string">'frame/frame'</span>,[
  <span class="string">'d3'</span>,
  <span class="string">'utils/mixins'</span>,
  <span class="string">'frame/states'</span>,
  <span class="string">'frame/state_machine'</span>
], <span class="function"><span class="keyword">function</span><span class="params">(d3, utils_mixins, states, StateMachine)</span> {</span>

  <span class="keyword">var</span> Frame = <span class="function"><span class="keyword">function</span> <span class="params">(conf)</span> {</span>
    <span class="keyword">var</span> self  = <span class="keyword">this</span>,
        utils = utils_mixins();
    
    <span class="keyword">this</span>.initial_frame = <span class="keyword">this</span>.frame = conf.frame;
    <span class="keyword">this</span>.old_frame =   <span class="keyword">void</span> <span class="number">0</span>;
    <span class="keyword">this</span>.current_timeout = <span class="keyword">void</span> <span class="number">0</span>;
    <span class="keyword">this</span>.drawChart = conf.drawChart;
    <span class="keyword">this</span>.delta = conf.delta;
    <span class="keyword">this</span>.step = conf.step;
    <span class="keyword">this</span>.data = conf.data;

    <span class="keyword">this</span>.state_machine = <span class="keyword">new</span> StateMachine(states.transition_states);
    <span class="keyword">this</span>.dispatch = d3.dispatch(
      <span class="string">'start'</span>, 
      <span class="string">'stop'</span>, 
      <span class="string">'next'</span>, 
      <span class="string">'prev'</span>, 
      <span class="string">'reset'</span>, 
      <span class="string">'end'</span>,
      <span class="string">'jump'</span>,
      <span class="string">'at_beginning_of_transition'</span>
    );</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Initial frame. The chart is rendered for the first time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.drawChart(<span class="keyword">this</span>.data[<span class="keyword">this</span>.frame]);</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Fired when all the chart related transitions within a frame are 
terminated.
It is the only dispatch event that does not have a state_machine 
equivalent event.
<code>frame</code> is an arbitrary namespace, in order to register multiple 
listeners for the same event type.</p>
<p><a href="https://github.com/mbostock/d3/wiki/Internals#events">https://github.com/mbostock/d3/wiki/Internals#events</a>:
If an event listener was already registered for the same type, the 
existing listener is removed before the new listener is added. To 
register multiple listeners for the same event type, the type may be 
followed by an optional namespace, such as &#39;click.foo&#39; and &#39;click.bar&#39;.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.dispatch.on(<span class="string">'end.frame'</span>, self.handleFrameEnd);

    <span class="keyword">this</span>.dispatch.on(<span class="string">'stop'</span>, self.handleStop);

    <span class="keyword">this</span>.dispatch.on(<span class="string">'start'</span>, self.handleStart);

    <span class="keyword">this</span>.dispatch.on(<span class="string">'next'</span>, self.handleNext);

    <span class="keyword">this</span>.dispatch.on(<span class="string">'prev'</span>, self.handlePrev);

    <span class="keyword">this</span>.dispatch.on(<span class="string">'reset'</span>, self.handleReset);

    <span class="keyword">this</span>.dispatch.on(<span class="string">'jump'</span>, self.handleJump);
  }


  Frame.prototype.startTransition = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> self = <span class="keyword">this</span>;
    clearTimeout(<span class="keyword">this</span>.current_timeout);
    <span class="keyword">if</span> (<span class="keyword">this</span>.data[<span class="keyword">this</span>.frame]) {
      <span class="keyword">this</span>.current_timeout = setTimeout( <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Re-render the chart</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        self.drawChart(self.data[self.frame]);
      }, self.step);
    } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>When no data is left to consume, let us stop the running frames!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.state_machine.consumeEvent(<span class="string">'stop'</span>);
      <span class="keyword">this</span>.frame = <span class="keyword">this</span>.old_frame;
    }
    self.dispatch.at_beginning_of_transition.call(self);
  }

  Frame.prototype.handleFrameEnd = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">this</span>.handleTransition();
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  Frame.prototype.handleStop = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">this</span>.state_machine.consumeEvent(<span class="string">'stop'</span>);
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>TODO: there is a lot of repetition here!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Frame.prototype.handleStart = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">if</span> (<span class="keyword">this</span>.state_machine.getStatus() === <span class="string">'in_pause'</span>) {
      <span class="keyword">this</span>.state_machine.consumeEvent(<span class="string">'start'</span>);
      <span class="keyword">this</span>.handleTransition();
    } <span class="keyword">else</span> {
      console.log(<span class="string">'State already in in_transition_start.'</span>);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>TODO:
for next and prev we are allowing multiple prev-next events to be 
fired without waiting for the current frame to end. Change?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Frame.prototype.handleNext = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">this</span>.state_machine.consumeEvent(<span class="string">'next'</span>);
    <span class="keyword">if</span> (<span class="keyword">this</span>.state_machine.getStatus() === <span class="string">'in_transition_next'</span>) {
      <span class="keyword">this</span>.handleTransition();
    } <span class="keyword">else</span> {
      console.log(<span class="string">'State not in pause when next event was fired.'</span>);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  Frame.prototype.handlePrev = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">this</span>.state_machine.consumeEvent(<span class="string">'prev'</span>);
    <span class="keyword">if</span> (<span class="keyword">this</span>.state_machine.getStatus() === <span class="string">'in_transition_prev'</span>) {
      <span class="keyword">this</span>.handleTransition();
    } <span class="keyword">else</span> {
      console.log(<span class="string">'State not in pause when prev event was fired.'</span>);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  Frame.prototype.handleReset = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">this</span>.state_machine.consumeEvent(<span class="string">'reset'</span>);
    <span class="keyword">if</span> (<span class="keyword">this</span>.state_machine.getStatus() === <span class="string">'in_transition_reset'</span>) {
      <span class="keyword">this</span>.handleTransition();
    } <span class="keyword">else</span> {
      console.log(<span class="string">'State not in pause when reset event was fired.'</span>);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  Frame.prototype.handleJump = <span class="function"><span class="keyword">function</span> <span class="params">(value)</span> {</span>
    <span class="keyword">this</span>.state_machine.consumeEvent(<span class="string">'jump'</span>);
    <span class="keyword">if</span> (<span class="keyword">this</span>.state_machine.getStatus() === <span class="string">'in_transition_jump'</span>) {
      <span class="keyword">this</span>.handleTransition(value);
    } <span class="keyword">else</span> {
      console.log(<span class="string">'State not in pause when jump event was fired.'</span>);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  
  Frame.prototype.handleTransition = <span class="function"><span class="keyword">function</span> <span class="params">(value)</span> {</span>
    <span class="keyword">var</span> self = <span class="keyword">this</span>, status = <span class="keyword">this</span>.state_machine.getStatus();
    <span class="keyword">if</span> (status === <span class="string">'in_transition_start'</span>) {
      <span class="keyword">this</span>.old_frame = <span class="keyword">this</span>.frame;
      <span class="keyword">this</span>.frame += <span class="keyword">this</span>.delta;
      <span class="keyword">this</span>.startTransition();
    } <span class="keyword">else</span> <span class="keyword">if</span> (status === <span class="string">'in_transition_prev'</span>) {
      <span class="keyword">this</span>.old_frame = <span class="keyword">this</span>.frame;
      <span class="keyword">this</span>.frame -= <span class="keyword">this</span>.delta;
      <span class="keyword">this</span>.startTransition();
      self.state_machine.consumeEvent(<span class="string">'stop'</span>);
    } <span class="keyword">else</span> <span class="keyword">if</span> (status === <span class="string">'in_transition_next'</span>) {
      <span class="keyword">this</span>.old_frame = <span class="keyword">this</span>.frame;
      <span class="keyword">this</span>.frame += <span class="keyword">this</span>.delta;
      <span class="keyword">this</span>.startTransition();
      self.state_machine.consumeEvent(<span class="string">'stop'</span>);
    } <span class="keyword">else</span> <span class="keyword">if</span> (status === <span class="string">'in_transition_jump'</span>) {
      <span class="keyword">if</span> (!value) <span class="keyword">return</span> <span class="keyword">new</span> Error(<span class="string">'need to pass a value to jump!'</span>);
      <span class="keyword">this</span>.old_frame = <span class="keyword">this</span>.frame;
      <span class="keyword">this</span>.frame = value;
      <span class="keyword">this</span>.startTransition();
      self.state_machine.consumeEvent(<span class="string">'stop'</span>);
    } <span class="keyword">else</span> <span class="keyword">if</span> (status === <span class="string">'in_transition_reset'</span>) {
      <span class="keyword">this</span>.old_frame = <span class="keyword">this</span>.frame;
      <span class="keyword">this</span>.frame = <span class="keyword">this</span>.initial_frame;
      <span class="keyword">this</span>.startTransition();
      self.state_machine.consumeEvent(<span class="string">'stop'</span>);
    } <span class="keyword">else</span> <span class="keyword">if</span> (status === <span class="string">'in_pause'</span>) {
      <span class="keyword">return</span>;
    } 
  }

  <span class="keyword">return</span> Frame;
  
});


define(<span class="string">'chart'</span>,[
  <span class="string">"d3"</span>, 
  <span class="string">"d3_tip"</span>,
  <span class="string">"draw"</span>,
  <span class="string">"base_config"</span>,
  <span class="string">"utils/mixins"</span>,
  <span class="string">"mixins/data"</span>,
  <span class="string">"mixins/layout"</span>,
  <span class="string">"mixins/scale"</span>,
  <span class="string">"mixins/axis"</span>,
  <span class="string">"mixins/chart"</span>,
  <span class="string">"bar/config"</span>,
  <span class="string">"bar/mixins"</span>, 
  <span class="string">"bar/bar"</span>,
  <span class="string">"line/config"</span>,
  <span class="string">"line/mixins"</span>,
  <span class="string">"line/line"</span>,
  <span class="string">"circle/config"</span>,
  <span class="string">"circle/mixins"</span>,
  <span class="string">"circle/circle"</span>,
  <span class="string">"frame/states"</span>,
  <span class="string">"frame/state_machine"</span>,
  <span class="string">"frame/frame"</span>
], <span class="function"><span class="keyword">function</span><span class="params">(
  d3, 
  d3_tip,
  draw, 
  base_config, 
  utils_mixins, 
  data_mixins, 
  layout_mixins, 
  scale_mixins,
  axis_mixins,
  chart_mixins,
  bar_config,
  bar_mixins,
  Bar,
  line_config,
  line_mixins,
  Line,
  circle_config,
  circle_mixins,
  Circle,
  states, 
  StateMachine, 
  Frame
)</span> {</span>

  d3.d3_tip = d3_tip;

  <span class="keyword">return</span> {
    d3: d3,
    draw: draw,
    base_config: base_config,
    utils_mixins: utils_mixins,
    data_mixins: data_mixins,
    layout_mixins: layout_mixins,
    scale_mixins: scale_mixins,
    axis_mixins: axis_mixins,
    chart_mixins: chart_mixins,
    bar_config: bar_config,
    bar_mixins: bar_mixins,
    Bar: Bar,
    line_config: line_config,
    line_mixins: line_mixins,
    Line: Line,
    circle_config: circle_config,
    circle_mixins: circle_mixins,
    Circle: Circle,
    Frame: Frame,
    states: states, 
    StateMachine: StateMachine,
  };

});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
